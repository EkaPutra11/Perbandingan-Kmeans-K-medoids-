{% extends 'base.html' %}

{% block title %}KMedoids Preprocessing - Arwana Sales Analytics{% endblock %}

{% block content %}
<style>
    .preprocessing-header {
        background: linear-gradient(135deg, #198754 0%, #146c43 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 10px;
    }
    
    .preprocessing-header h1 {
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .preprocessing-header p {
        margin-bottom: 0;
        opacity: 0.95;
    }
    
    .control-card {
        border: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
        border-radius: 8px;
        overflow: hidden;
    }
    
    .control-card .card-header {
        background: linear-gradient(135deg, #198754 0%, #146c43 100%);
        border: none;
        padding: 1.2rem;
    }
    
    .control-card .card-header h5 {
        font-weight: 600;
        margin: 0;
    }
    
    .form-control {
        border-radius: 6px;
        border: 1px solid #dee2e6;
        padding: 0.7rem;
    }
    
    .form-control:focus {
        border-color: #198754;
        box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25);
    }
    
    .metrics-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .metric-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 8px;
        padding: 1.5rem;
        text-align: center;
        border-left: 4px solid #198754;
    }
    
    .metric-card h6 {
        color: #6c757d;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        margin-bottom: 0.5rem;
    }
    
    .metric-card h3 {
        color: #198754;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .metric-card small {
        color: #6c757d;
        font-size: 0.8rem;
    }
    
    .results-card {
        border: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border-radius: 8px;
        margin-bottom: 2rem;
        overflow: hidden;
    }
    
    .results-card .card-header {
        background-color: #f8f9fa;
        border-bottom: 2px solid #198754;
        padding: 1.2rem;
    }
    
    .results-card .card-header h5 {
        font-weight: 600;
        margin: 0;
        color: #333;
    }
    
    .nav-tabs .nav-link {
        color: #6c757d;
        border: none;
        border-bottom: 3px solid transparent;
        font-weight: 500;
        margin-bottom: -2px;
    }
    
    .nav-tabs .nav-link:hover {
        color: #198754;
        border-bottom-color: #198754;
    }
    
    .nav-tabs .nav-link.active {
        color: #198754;
        background-color: transparent;
        border-bottom-color: #198754;
    }
    
    .chart-container {
        position: relative;
        height: 400px;
        margin: 1rem 0;
    }
    
    .sidebar-card {
        border: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
        border-radius: 8px;
        overflow: hidden;
    }
    
    .sidebar-card.info-card {
        background: linear-gradient(135deg, #198754 0%, #146c43 100%);
        color: white;
    }
    
    .sidebar-card.legend-card {
        background: linear-gradient(135deg, #ffc107 0%, #ffb700 100%);
        color: #333;
    }
    
    .sidebar-card .card-header {
        background: rgba(0,0,0,0.1);
        border: none;
        padding: 1rem;
    }
    
    .sidebar-card .card-header h5 {
        font-weight: 600;
        margin: 0;
    }
    
    .sidebar-card .card-body {
        padding: 1rem;
    }
    
    .sidebar-card p {
        margin-bottom: 0.7rem;
        font-size: 0.9rem;
    }
    
    .sidebar-card ul {
        padding-left: 1.2rem;
        margin-bottom: 0;
    }
    
    .sidebar-card li {
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }
    
    .btn-success-large {
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        border-radius: 6px;
        border: none;
    }
    
    .status-success .spinner-border {
        color: #198754 !important;
    }
    
    .status-loading .spinner-border {
        color: #198754 !important;
    }
</style>

<div class="preprocessing-header">
    <div class="container">
        <h1>üìä K-Medoids Clustering</h1>
        <p>Implementasi PAM (Partitioning Around Medoids) dengan pengukuran kualitas Davies-Bouldin Index</p>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-lg-8">
            <!-- Clustering Form -->
            <div class="card control-card">
                <div class="card-header">
                    <h5>‚öôÔ∏è Konfigurasi Clustering</h5>
                </div>
                <div class="card-body">
                    <form id="kmedoids-form" method="POST">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="k-value" class="form-label fw-500">Jumlah Cluster (K)</label>
                                <input type="number" class="form-control" id="k-value" name="k" value="3" min="2" max="10">
                                <small class="text-muted">Tentukan jumlah cluster yang diinginkan (2-10)</small>
                            </div>
                            <div class="col-md-6 d-flex align-items-end">
                                <button type="button" class="btn btn-success btn-success-large w-100" id="run-btn">
                                    <span id="btn-text">‚ñ∂Ô∏è Jalankan Clustering</span>
                                    <span id="spinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
                                </button>
                            </div>
                        </div>
                    </form>
                    <div id="alert-container" class="mt-3"></div>
                    
                    <!-- Status Container -->
                    <div id="status-container" class="mt-3 d-none">
                        <div class="alert alert-info status-loading mb-0">
                            <div class="d-flex align-items-center">
                                <div id="status-spinner" class="me-3">
                                    <div class="spinner-border spinner-border-sm text-success" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                                <div>
                                    <h6 id="status-text" class="mb-1">Menjalankan KMedoids Clustering...</h6>
                                    <small id="status-message" class="text-muted">Mohon tunggu...</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Metrics Display -->
            <div id="metrics-container" class="d-none">
                <div class="metrics-row">
                    <div class="metric-card">
                        <h6>Total Cost</h6>
                        <h3 id="cost-value">-</h3>
                        <small>Jumlah jarak ke medoid</small>
                    </div>
                    <div class="metric-card" style="border-left-color: #0d6efd;">
                        <h6>Davies-Bouldin Index</h6>
                        <h3 id="dbi-value" style="color: #0d6efd;">-</h3>
                        <small>Semakin rendah semakin baik</small>
                    </div>
                </div>
            </div>

            <!-- Analysis Breakdown -->
            <div id="results-container" class="d-none">
                <div class="results-card">
                    <div class="card-header">
                        <h5>üìã Analisis Cluster per Kategori & Range Ukuran</h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs mb-3" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-bs-toggle="tab" href="#standard-tab">‚úì Standard</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#non-standard-tab">‚úó Non-Standard</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div id="standard-tab" class="tab-pane fade show active">
                                <div id="standard-content">
                                    <p class="text-muted text-center">Tidak ada data</p>
                                </div>
                            </div>

                            <div id="non-standard-tab" class="tab-pane fade">
                                <div id="non-standard-content">
                                    <p class="text-muted text-center">Tidak ada data</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chart -->
            <div id="chart-container" class="d-none">
                <div class="results-card">
                    <div class="card-header">
                        <h5>üìà Distribusi Cluster</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="cluster-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

<script src="{{ url_for('static', filename='js/preprocessing-kmedoids.js') }}"></script>
{% endblock %}
