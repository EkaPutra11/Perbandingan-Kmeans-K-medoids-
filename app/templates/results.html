{% extends 'base.html' %}

{% block title %}Hasil Clustering - Arwana Sales Analytics{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/results.css') }}">

<div class="results-container">
    <!-- Header -->
    <div class="results-header">
        <h1>üîç Hasil Clustering</h1>
        <p>Perbandingan KMeans vs KMedoids untuk kategori produk berdasarkan penjualan</p>
    </div>

    {% if formatted_results %}
        <!-- Comparison Section -->
        <div class="comparison-section">
            <!-- KMeans Card -->
            <div class="method-card method-kmeans">
                <div class="method-header">
                    <h2>KMeans Clustering</h2>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-box">
                        <div class="metric-label">Inertia</div>
                        <div class="metric-value">{{ "%.2f" | format(formatted_results.kmeans.inertia) }}</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Davies-Bouldin Index</div>
                        <div class="metric-value">{{ "%.3f" | format(formatted_results.kmeans.dbi) }}</div>
                    </div>
                </div>

                <!-- Analysis by Category -->
                {% for category_type, categories in formatted_results.kmeans.analysis.items() %}
                    <div class="category-section">
                        <div class="category-title">
                            {% if category_type == 'STANDARD' %}
                                === STANDARD ===
                            {% else %}
                                === NON-STANDARD ===
                            {% endif %}
                        </div>

                        <!-- Tiers -->
                        {% for tier_name, items in categories.items() %}
                            {% if items %}
                                <div class="tier-container">
                                    <div class="tier-header {% if tier_name == 'Terlaris' %}tier-terlaris{% elif tier_name == 'Sedang' %}tier-sedang{% else %}tier-kurang{% endif %}">
                                        <span class="tier-badge">{{ tier_name }}</span>
                                        <span class="tier-label">{{ tier_name }}</span>
                                        <span class="tier-count">{{ items|length }} item</span>
                                    </div>
                                    
                                    <div class="items-list">
                                        {% for item in items %}
                                            <div class="item-row">
                                                <div class="item-name">{{ item.kategori }}</div>
                                                <div class="item-size">{{ item.size_range }}</div>
                                                <div class="item-value">{{ "%.0f" | format(item.total) }}</div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}

                        <div style="text-align: right; margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <strong>DBI Terbaik: {{ "%.3f" | format(formatted_results.kmeans.dbi) }} (KMeans)</strong>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- KMedoids Card -->
            <div class="method-card method-kmedoids">
                <div class="method-header">
                    <h2>KMedoids Clustering</h2>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-box">
                        <div class="metric-label">Cost</div>
                        <div class="metric-value">{{ "%.2f" | format(formatted_results.kmedoids.cost) }}</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Davies-Bouldin Index</div>
                        <div class="metric-value">{{ "%.3f" | format(formatted_results.kmedoids.dbi) }}</div>
                    </div>
                </div>

                <!-- Analysis by Category -->
                {% for category_type, categories in formatted_results.kmedoids.analysis.items() %}
                    <div class="category-section">
                        <div class="category-title">
                            {% if category_type == 'STANDARD' %}
                                === STANDARD ===
                            {% else %}
                                === NON-STANDARD ===
                            {% endif %}
                        </div>

                        <!-- Tiers -->
                        {% for tier_name, items in categories.items() %}
                            {% if items %}
                                <div class="tier-container">
                                    <div class="tier-header {% if tier_name == 'Terlaris' %}tier-terlaris{% elif tier_name == 'Sedang' %}tier-sedang{% else %}tier-kurang{% endif %}">
                                        <span class="tier-badge">{{ tier_name }}</span>
                                        <span class="tier-label">{{ tier_name }}</span>
                                        <span class="tier-count">{{ items|length }} item</span>
                                    </div>
                                    
                                    <div class="items-list">
                                        {% for item in items %}
                                            <div class="item-row">
                                                <div class="item-name">{{ item.kategori }}</div>
                                                <div class="item-size">{{ item.size_range }}</div>
                                                <div class="item-value">{{ "%.0f" | format(item.total) }}</div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}

                        <div style="text-align: right; margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <strong>DBI Terbaik: {{ "%.3f" | format(formatted_results.kmedoids.dbi) }} (KMedoids)</strong>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Comparison Summary -->
        <div style="margin-top: 40px; padding: 25px; background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">
            <h3 style="color: #2c3e50; margin-bottom: 20px;">üìä Ringkasan Perbandingan</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <p><strong>KMeans</strong></p>
                    <ul style="list-style: none; padding: 0;">
                        <li>‚úì Inertia: {{ "%.2f" | format(formatted_results.kmeans.inertia) }}</li>
                        <li>‚úì DBI: {{ "%.3f" | format(formatted_results.kmeans.dbi) }}</li>
                        <li>‚úì Algoritma berbasis centroid</li>
                    </ul>
                </div>
                <div>
                    <p><strong>KMedoids</strong></p>
                    <ul style="list-style: none; padding: 0;">
                        <li>‚úì Cost: {{ "%.2f" | format(formatted_results.kmedoids.cost) }}</li>
                        <li>‚úì DBI: {{ "%.3f" | format(formatted_results.kmedoids.dbi) }}</li>
                        <li>‚úì Algoritma berbasis medoid (representatif)</li>
                    </ul>
                </div>
            </div>
            <p style="margin-top: 20px; color: #7f8c8d; font-size: 0.95rem;">
                <strong>Nilai DBI lebih rendah menunjukkan clustering yang lebih baik.</strong> 
                {% if formatted_results.kmeans.dbi < formatted_results.kmedoids.dbi %}
                    KMeans menghasilkan clustering dengan kualitas lebih baik pada dataset ini.
                {% else %}
                    KMedoids menghasilkan clustering dengan kualitas lebih baik pada dataset ini.
                {% endif %}
            </p>
        </div>

    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üì≠</div>
            <p>Belum ada hasil clustering</p>
            <p>Silakan jalankan clustering terlebih dahulu di halaman Preprocessing</p>
            <div style="margin-top: 20px;">
                <a href="/preprocessing/kmeans" class="btn btn-primary me-2">KMeans Preprocessing</a>
                <a href="/preprocessing/kmedoids" class="btn btn-success">KMedoids Preprocessing</a>
            </div>
        </div>
    {% endif %}
</div>

{% if formatted_results %}
<script src="{{ url_for('static', filename='js/results.js') }}"></script>
{% endif %}
{% endblock %}
